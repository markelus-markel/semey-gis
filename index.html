<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alau AI: ГИС Семей</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; background: #0f172a; color: white; }
        #map { height: 100vh; width: 100vw; }
        .glass-panel { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.1); }
        .active-btn { background: #3b82f6 !important; }
    </style>
</head>
<body>

    <div class="fixed top-4 left-4 right-4 z-[1000] glass-panel p-4 rounded-2xl shadow-2xl">
        <h1 class="font-bold text-lg">ALAU AI <span class="text-blue-400 text-sm">ГИС СЕМЕЙ</span></h1>
        <p id="stats" class="text-xs text-slate-400 italic">Загрузка 555+ домов...</p>
    </div>

    <div class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[1000] glass-panel p-2 rounded-2xl flex gap-2 shadow-2xl overflow-x-auto max-w-[95vw]">
        <button onclick="flyToDistrict('all')" id="btn-all" class="px-4 py-2 rounded-xl text-sm whitespace-nowrap bg-slate-800 active-btn">Все</button>
        <button onclick="flyToDistrict('Общегородской центр')" class="px-4 py-2 rounded-xl text-sm whitespace-nowrap bg-slate-800">Центр</button>
        <button onclick="flyToDistrict('Жилой район Цемпоселок')" class="px-4 py-2 rounded-xl text-sm whitespace-nowrap bg-slate-800">Цемпоселок</button>
        <button onclick="flyToDistrict('Проспект Ауэзова')" class="px-4 py-2 rounded-xl text-sm whitespace-nowrap bg-slate-800">Ауэзова</button>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let map, markers;
        const coords = { 'all': [50.41, 80.25], 'Общегородской центр': [50.412, 80.247], 'Жилой район Цемпоселок': [50.401, 80.215], 'Проспект Ауэзова': [50.416, 80.255] };

        function init() {
            map = L.map('map', { zoomControl: false }).setView(coords.all, 13);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
            markers = L.layerGroup().addTo(map);
            load();
        }

        async function load() {
            try {
                const res = await fetch('buildings_fixed_locations.json');
                const data = await res.json();
                render(data);
                const osi = data.filter(d => d.management_type === 'ОСИ').length;
                document.getElementById('stats').innerHTML = `Всего: <b>${data.length}</b> МКД | ОСИ: <b>${osi}</b> (${(osi/data.length*100).toFixed(1)}%)`;
            } catch (e) { document.getElementById('stats').innerText = "Ошибка данных"; }
        }

        function render(data) {
            markers.clearLayers();
            data.forEach(d => {
                if (d.latitude && d.longitude) {
                    const color = d.management_type === 'ОСИ' ? '#22c55e' : '#3b82f6';
                    const m = L.circleMarker([d.latitude, d.longitude], { radius: 6, fillColor: color, color: '#fff', weight: 1, fillOpacity: 0.8 });
                    m.bindPopup(`<b class="text-slate-900">${d.address}</b><br><small class="text-slate-600">${d.district}<br>Упр: ${d.management_type}</small>`);
                    markers.addLayer(m);
                }
            });
        }

        function flyToDistrict(d) {
            map.flyTo(coords[d] || coords.all, 14);
            document.querySelectorAll('button').forEach(b => b.classList.remove('active-btn'));
            event.target.classList.add('active-btn');
        }

        window.onload = init;
    </script>
</body>
</html>
